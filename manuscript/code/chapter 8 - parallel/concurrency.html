<html>
        <head>

                <script type="text/javascript" src="jstat.min.js"></script>
                <script type="text/javascript" src="monteCarlo.js"></script>
        </head>
        <body></body>
        
        <script type="text/javascript" charset="utf-8">
        
                "use strict";
                
                ////////////////////////////////////
                
                var workerResult = n => 'Result: ' + n;
  
                myWorker.postMessage([workerResult(1)]);
                
        	console.log('Message posted to worker');

        	myWorker.postMessage([workerResult(2)]);
        	console.log('Message posted to worker');

        	myWorker.onmessage =
                        e =>
                                {
                                var result = e.data;
                		console.log('Message received from worker');
                                console.log(result);
                	        };
        
                //this as the prototype function
                //accepts function
                //applies function after intial array gen
                //if poss would simplify code quite a bit... 
                const generate = n =>
                        n <= 1 ? 
                                [0]
                                :
                                [0].concat(generate(n-1));
                             
                Function.prototype.take = n =>
                        n <= 1 ? 
                                [0].this
                                :
                                [0].concat(generate(n-1));
                             
                 Array.prototype.brownianMotion = function(){
                        return this.map( 
                                _ => Math.random()
                                );
                        }
                        
                //collect results
                var postBox = function*(){
                        console.time("Concurrent");
                        
                        const a = yield;
                        
                        const b = yield;
                        
                        console.log( (a + b) / 2 );
                                
                        console.timeEnd("Concurrent");
                        }
                
                //init
                const send = postBox();
                send.next();
                
                //create worker object
                const c =
                        (forwardStrikePrice, spot, volatility, expiry, interestRate) =>
                                {
                                const w = new Worker("worker.js");
                                w.postMessage(
                                        [
                                                {
                                                forwardStrikePrice:     forwardStrikePrice, 
                                                spot:                   spot, 
                                                volatility:             volatility, 
                                                expiry:                 expiry, 
                                                interestRate:           interestRate
                                                }
                                        ] 
                                        );    
                                w.onmessage =
                                        result =>
                                                {
                                  		console.log('Message received from worker');
                                                console.log(result.data);
                                                send.next(result.data);
                                  	        };
                                return w;
                                }
                                
                c(110, 100, 0.1, 10, 0.01);
            
                Array.prototype.fibonacciNumbers = function(){
                        return this.reduce( 
                                (a,c) =>
                                        a.concat(a[a.length-1]+a[a.length-2]), 
                                [0,1] 
                                );
                        }
        
                        
                Array.prototype.randomNumbers = function(){
                        return this.map( 
                                _ => Math.random()
                                );
                        }
        
                c(110, 100, 0.1, 10, 0.01);
                
        </script>
           
</html>
