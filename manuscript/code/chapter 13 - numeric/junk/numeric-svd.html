<html>
<head>
        <script type="text/javascript" src="d3.v3.min.js"></script>
        <script type="text/javascript" src="numeric-1.2.6.min.js"></script>
        <script type="text/javascript" src="quandl-api-key.js"></script>
        <!--
        <script type="text/javascript" src="underscore-min.js"></script>
        -->
        <script type="text/javascript" src="lodash.min.js"></script>
        <script type="text/javascript" src="jstat.min.js"></script>
        
</head>
<body>
        <div id='graph' style="width:800;height:700"></div>
</body>
<script>
        "use strict";
        
        
        //pull in data
        //demean
        
        
        
        //accumulate data and plot
        const postBox = function*(origReturns){
                
                const closes = _.chain(yield).pluck('Close').take(252);

                const before = closes.rest().value();
                const after = closes.initial().value();
                
                const returns = numeric.log( numeric['/']( after, before ) );
                const mean = jStat.mean(returns);
                const demeanedReturns = numeric['-']( returns, mean );
                
                const newReturns = origReturns.concat( [demeanedReturns] );
                
                yield* postBox(newReturns);
                }
        
        //y = b * A
        
        //init
        /*
        const send = postBox([]);
        send.next();
        
        const grabData = (ticker, quandlApiKey) =>
                d3.csv( "https://www.quandl.com/api/v3/datasets/YAHOO/"+ticker+".csv?auth_token="+quandlApiKey, 
                        data => send.next( data ) 
                        );
        
        grabData("FB", quandlApiKey);
        grabData("MS", quandlApiKey);
        grabData("MSFT", quandlApiKey);
        grabData("STT", quandlApiKey);
        */
                
        const x = numeric.solveLP(
                [1,1],                   /* minimize [1,1]*x                */
                [[-1,0],[0,-1],[-1,-2]], /* matrix of inequalities          */
                [0,0,-3]                 /* right-hand-side of inequalities */
                );       
        const y = numeric.trunc(x.solution,1e-12);
        
        console.log(y);
        
</script>
</html>
