<html>
<head>
        <script type="text/javascript" src="d3.v3.min.js"></script>
        <script type="text/javascript" src="numeric-1.2.6.min.js"></script>
        <script type="text/javascript" src="quandl-api-key.js"></script>
        <!--
        <script type="text/javascript" src="underscore-min.js"></script>
        -->
        <script type="text/javascript" src="lodash.min.js"></script>
        <script type="text/javascript" src="jstat.min.js"></script>
        
</head>
<body>
        <div id='graph' style="width:800;height:700"></div>
</body>
<script>
        "use strict";
        //accumulate data and plot
        const postBox = function*(){
                const a = yield;
                
                
                const groups = _.chain(a)
                        .reduce(
                                (accumulant, current) =>
                                        
                                        return accumulant[current.Country] === undefined ?
                                                accumulant[current.Country] = [current]
                                                :
                                                accumulant[current.Country].concat(current);
                                                
                                , {}
                                );
                
                
                /*
                const groups = _.chain(a)
                        .map( x => Object.assign(x, { Price: x["Market Value"] / x["Shares"] } ) )
                        .groupBy(x => x.Price < 1)
                        .map(
                                y => _.chain(y)
                                        .groupBy( z => z.Country )
                                        .value()
                                )
                        .value()
                        ;
                */
                
                
                      
                /*
                const before = closes.rest().value();
                const after = closes.initial().value();
                
                const returns = numeric.log( numeric['/'](after,before) );
                
                const mean = jStat.mean(returns);
                
                const demeanedReturns = numeric['-'](returns,mean);
                */
                console.log(groups);
                
                }
        
        //init
        const send = postBox();
        send.next();
        
        d3.csv( "cppib-20150331-public-equity.csv", 
                data => send.next( data ) 
                )
               
        
</script>
</html>
