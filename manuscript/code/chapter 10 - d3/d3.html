<html>
<head>
        <script type="text/javascript" src="d3.v3.min.js"></script>
        <script type="text/javascript" src="d3.layout.cloud.js"></script>
        <!--
                <script type="text/javascript" src="http://underscorejs.org/underscore-min.js"></script>
        -->
</head>
<body>
        
</body>
<script>
        const fill = d3.scale.category20();


        const draw = words =>
                d3      .select("body")
                        .append("svg")
                                .attr("width", 300)
                                .attr("height", 300)
                        .append("g")
                                .attr("transform", "translate(150,150)")
                                .selectAll("text")
                                .data(words)
                                .enter()
                        .append("text")
                                .style("font-size", d => d.size + "px")
                                .style("font-family", "Impact")
                                .style("fill", (d, i) => fill(i) )
                                .attr("text-anchor", "middle")
                                .attr("transform", d => "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")")
                                .text( d => d.text);
                

        d3      .layout
                .cloud()
                .size([300, 300])
                .words(
                        [".NET", "Silverlight", "jQuery", "CSS3", "HTML5", "JavaScript", "SQL","C#"]
                                .map( d => 
                                        ( {text: d, size: 10 + Math.random() * 50} ) 
                                        ) 
                        )
                .rotate( _ => ~~(Math.random() * 2) * 90 )
                .font("Impact")
                .fontSize( d => d.size )
                .on("end", draw)
                .start();
        
        //d3.csv( "", data => console.log(data) );
        
        //var dsv = d3.dsv(" ", "text/plain");
        
        //dsv( "text.txt", b=>console.log(b) );
        
        
        
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange = function(){
                if(xmlhttp.status==200 && xmlhttp.readyState==4){    
                        var words = xmlhttp
                                .responseText
                                .split([' '])
                                .map(w=>w.trim());
                                
                        const freq = words
                                .reduce(
                                        (a,c) =>
                                                {
                                                
                                                //with
                                                const w = a.filter( d => d.word === c );
                                                //without
                                                const wo = a.filter( d => d.word != c );
                                                
                                                
                                                
                                                //if nothing's filtered out - new word
                                                if ( w.length === 0 ) {
                                                        const b = wo.concat( {word: c, count: 1} );
                                                        }
                                                else {
                                                        const b = wo.concat( {word: c, count: w[0].count + 1} );   
                                                        }       
                                                return b;  
                                                }
                                        ,[]
                                        );
                                
                        console.log(words);
                        console.log(freq.sort((a,b)=>a.count < b.count));
                        }
                }
        xmlhttp.open("GET","text.txt",true);
        xmlhttp.send();
        
        
        
        /*       
        //http://www.sec.gov/Archives/edgar/data/320193/000119312515356351/d17062d10k.htm#toc17062_3
        words = Document.querySelectorAll('p')
                .map(
                        i=>i.innerHTML.split(" ")
                        )
                .reduce(
                        (a,c)=>a.concat(c)
                        ,[]
                        )
        
        console.log(
                words.reduce((a,c)=>a.find(x=>x===c)?a.concat(c):a,[])
                );
        */
</script>